<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Accessibility Widget</title>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    
    .widget-container {
      width: 100%;
      height: 100%;
      padding: 20px;
      box-sizing: border-box;
      overflow-y: auto;
      background-color: white;
    }
    
    .widget-header {
      margin-bottom: 24px;
      text-align: center;
    }
    
    .widget-header h2 {
      font-size: 24px;
      font-weight: 700;
      margin: 0 0 8px;
      color: #1a1a1a;
    }
    
    .widget-header p {
      font-size: 16px;
      margin: 0;
      color: #666;
    }
    
    .widget-section {
      margin-bottom: 28px;
    }
    
    .widget-section-title {
      font-size: 18px;
      font-weight: 600;
      margin: 0 0 16px;
      color: #1a1a1a;
    }
    
    .widget-options {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .widget-option {
      display: flex;
      align-items: center;
      padding: 12px;
      background: #f5f5f5;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }
    
    .widget-option:hover {
      background: #ebebeb;
    }
    
    .widget-option.active {
      background: #e6f2ff;
      border: 1px solid #0066ff;
    }
    
    .widget-option-icon {
      width: 24px;
      height: 24px;
      margin-right: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .widget-option-label {
      font-size: 14px;
      font-weight: 500;
    }
    
    .widget-option-description {
      font-size: 12px;
      color: #666;
      margin-top: 4px;
    }
    
    /* Profile section */
    .profile-list {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }
    
    .profile-item {
      padding: 14px;
      background: #f5f5f5;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .profile-item:hover {
      background: #ebebeb;
    }
    
    .profile-item-title {
      font-weight: 600;
      margin-bottom: 6px;
    }
    
    .profile-item-description {
      font-size: 13px;
      color: #666;
    }
    
    /* Scaling controls */
    .scaling-control {
      margin-bottom: 16px;
    }
    
    .scaling-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .scaling-label-text {
      font-size: 14px;
      font-weight: 500;
    }
    
    .scaling-options {
      display: flex;
      gap: 8px;
    }
    
    .scaling-option {
      padding: 8px 14px;
      background: #f5f5f5;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      transition: all 0.2s;
    }
    
    .scaling-option:hover {
      background: #ebebeb;
    }
    
    .scaling-option.active {
      background: #e6f2ff;
      color: #0066ff;
      font-weight: 500;
    }
    
    /* Footer */
    .widget-footer {
      margin-top: 24px;
      text-align: center;
    }
    
    .reset-button {
      background: #f5f5f5;
      border: none;
      padding: 10px 20px;
      border-radius: 6px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
    }
    
    .reset-button:hover {
      background: #ebebeb;
    }
  </style>
</head>
<body>
  <div class="widget-container">
    <div class="widget-header">
      <h2>Barrierefreiheit Optionen</h2>
      <p>Passen Sie Ihr Surferlebnis an</p>
    </div>
    
    <div class="widget-section">
      <h3 class="widget-section-title">Barrierefreiheit Profile</h3>
      <div class="profile-list">
        <div class="profile-item" onclick="applyProfile('seizure-safe')">
          <div class="profile-item-title">Epilepsie-sicher</div>
          <div class="profile-item-description">Eliminiert Blitze und reduziert Farben</div>
        </div>
        <div class="profile-item" onclick="applyProfile('vision-impaired')">
          <div class="profile-item-title">Sehbehinderung</div>
          <div class="profile-item-description">Verbessert die visuelle Darstellung der Website</div>
        </div>
        <div class="profile-item" onclick="applyProfile('cognitive')">
          <div class="profile-item-title">Kognitive Behinderung</div>
          <div class="profile-item-description">Unterstützt Fokus und Lesbarkeit</div>
        </div>
        <div class="profile-item" onclick="applyProfile('adhd')">
          <div class="profile-item-title">ADHS Freundlich</div>
          <div class="profile-item-description">Reduziert Ablenkungen und Lärm</div>
        </div>
      </div>
    </div>
    
    <div class="widget-section">
      <h3 class="widget-section-title">Anzeigeoptionen</h3>
      <div class="widget-options">
        <div class="widget-option" onclick="toggleSetting('darkContrast')">
          <div class="widget-option-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 2a7 7 0 1 0 0 14 7 7 0 1 0 0-14z"></path></svg>
          </div>
          <div>
            <div class="widget-option-label">Dunkler Kontrast</div>
            <div class="widget-option-description">Invertiert Farben für höheren Kontrast</div>
          </div>
        </div>
        <div class="widget-option" onclick="toggleSetting('lightContrast')">
          <div class="widget-option-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><path d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"></path></svg>
          </div>
          <div>
            <div class="widget-option-label">Heller Kontrast</div>
            <div class="widget-option-description">Verbessert die Sichtbarkeit im hellen Modus</div>
          </div>
        </div>
        <div class="widget-option" onclick="toggleSetting('monochrome')">
          <div class="widget-option-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2"></rect><path d="M9 3v18"></path><path d="M15 3v18"></path><path d="M3 9h18"></path><path d="M3 15h18"></path></svg>
          </div>
          <div>
            <div class="widget-option-label">Monochrom</div>
            <div class="widget-option-description">Entfernt alle Farben</div>
          </div>
        </div>
        <div class="widget-option" onclick="toggleSetting('highSaturation')">
          <div class="widget-option-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="4"></circle></svg>
          </div>
          <div>
            <div class="widget-option-label">Hohe Sättigung</div>
            <div class="widget-option-description">Verbessert die Farbintensität</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="widget-section">
      <h3 class="widget-section-title">Inhalt Skalierung</h3>
      <div class="scaling-control">
        <div class="scaling-label">
          <span class="scaling-label-text">Textgröße</span>
        </div>
        <div class="scaling-options">
          <div class="scaling-option active" onclick="updateSetting('fontSize', 'default')">A</div>
          <div class="scaling-option" onclick="updateSetting('fontSize', 'large')">A+</div>
          <div class="scaling-option" onclick="updateSetting('fontSize', 'x-large')">A++</div>
          <div class="scaling-option" onclick="updateSetting('fontSize', 'xx-large')">A+++</div>
        </div>
      </div>
      <div class="scaling-control">
        <div class="scaling-label">
          <span class="scaling-label-text">Zeilenabstand</span>
        </div>
        <div class="scaling-options">
          <div class="scaling-option active" onclick="updateSetting('lineSpacing', 'default')">Standard</div>
          <div class="scaling-option" onclick="updateSetting('lineSpacing', 'medium')">Mittel</div>
          <div class="scaling-option" onclick="updateSetting('lineSpacing', 'large')">Groß</div>
        </div>
      </div>
      <div class="scaling-control">
        <div class="scaling-label">
          <span class="scaling-label-text">Buchstabenabstand</span>
        </div>
        <div class="scaling-options">
          <div class="scaling-option active" onclick="updateSetting('letterSpacing', 'default')">Standard</div>
          <div class="scaling-option" onclick="updateSetting('letterSpacing', 'medium')">Mittel</div>
          <div class="scaling-option" onclick="updateSetting('letterSpacing', 'large')">Groß</div>
        </div>
      </div>
    </div>
    
    <div class="widget-section">
      <h3 class="widget-section-title">Navigationshilfe</h3>
      <div class="widget-options">
        <div class="widget-option" onclick="toggleSetting('readingGuide')">
          <div class="widget-option-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3v18h18"></path><path d="m21 3-9 9"></path><path d="m21 12-9 9"></path><path d="m12 3-9 9"></path></svg>
          </div>
          <div>
            <div class="widget-option-label">Leseführung</div>
            <div class="widget-option-description">Fügt eine horizontale Führung hinzu, die dem Cursor folgt</div>
          </div>
        </div>
        <div class="widget-option" onclick="toggleSetting('readingMask')">
          <div class="widget-option-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"></rect><line x1="9" x2="15" y1="15" y2="15"></line></svg>
          </div>
          <div>
            <div class="widget-option-label">Lesemaske</div>
            <div class="widget-option-description">Verdunkelt die Seite außer dem Bereich um den Cursor</div>
          </div>
        </div>
        <div class="widget-option" onclick="toggleSetting('largeCursor')">
          <div class="widget-option-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z"></path><path d="m13 13 6 6"></path></svg>
          </div>
          <div>
            <div class="widget-option-label">Großer Cursor</div>
            <div class="widget-option-description">Macht den Cursor größer und besser sichtbar</div>
          </div>
        </div>
      </div>
    </div>
    
    <div class="widget-footer">
      <button class="reset-button" onclick="resetSettings()">Alle Einstellungen zurücksetzen</button>
    </div>
  </div>

  <script>
    // State management
    let settings = {
      darkContrast: false,
      lightContrast: false,
      monochrome: false,
      highSaturation: false,
      fontSize: 'default',
      lineSpacing: 'default',
      letterSpacing: 'default',
      readingGuide: false,
      readingMask: false,
      largeCursor: false
    };
    
    let activeProfile = null;
    
    // Initialize
    function init() {
      // Load saved settings
      const savedSettings = localStorage.getItem('accessibilitySettings');
      if (savedSettings) {
        try {
          const parsed = JSON.parse(savedSettings);
          settings = parsed.settings || settings;
          activeProfile = parsed.activeProfile || null;
          updateUIState();
        } catch (e) {
          console.error('Failed to parse saved settings:', e);
        }
      }
      
      // Send message to parent window that we're ready
      if (window.parent && window !== window.parent) {
        window.parent.postMessage({ 
          type: 'WIDGET_LOADED',
          settings: settings
        }, '*');
      }
      
      // Apply settings to parent window
      applySettingsToParent();
    }
    
    // Toggle boolean settings
    function toggleSetting(setting) {
      settings[setting] = !settings[setting];
      activeProfile = null; // Clear active profile when manual changes are made
      updateUIState();
      saveSettings();
      applySettingsToParent();
    }
    
    // Update value settings
    function updateSetting(setting, value) {
      settings[setting] = value;
      activeProfile = null; // Clear active profile when manual changes are made
      updateUIState();
      saveSettings();
      applySettingsToParent();
    }
    
    // Apply preset profile
    function applyProfile(profile) {
      activeProfile = profile;
      
      // Reset all settings first
      settings = {
        darkContrast: false,
        lightContrast: false,
        monochrome: false,
        highSaturation: false,
        fontSize: 'default',
        lineSpacing: 'default',
        letterSpacing: 'default',
        readingGuide: false,
        readingMask: false,
        largeCursor: false
      };
      
      // Apply profile-specific settings
      switch(profile) {
        case 'seizure-safe':
          settings.monochrome = true;
          break;
        case 'vision-impaired':
          settings.fontSize = 'x-large';
          settings.lineSpacing = 'large';
          settings.highSaturation = true;
          break;
        case 'cognitive':
          settings.lineSpacing = 'medium';
          settings.letterSpacing = 'medium';
          settings.readingGuide = true;
          break;
        case 'adhd':
          settings.readingMask = true;
          break;
      }
      
      updateUIState();
      saveSettings();
      applySettingsToParent();
    }
    
    // Reset all settings
    function resetSettings() {
      settings = {
        darkContrast: false,
        lightContrast: false,
        monochrome: false,
        highSaturation: false,
        fontSize: 'default',
        lineSpacing: 'default',
        letterSpacing: 'default',
        readingGuide: false,
        readingMask: false,
        largeCursor: false
      };
      activeProfile = null;
      
      updateUIState();
      saveSettings();
      applySettingsToParent();
    }
    
    // Update the UI to reflect current settings
    function updateUIState() {
      // Toggle options
      Object.keys(settings).forEach(key => {
        if (typeof settings[key] === 'boolean') {
          const element = document.querySelector(`.widget-option[onclick="toggleSetting('${key}')"]`);
          if (element) {
            if (settings[key]) {
              element.classList.add('active');
            } else {
              element.classList.remove('active');
            }
          }
        }
      });
      
      // Value options (font size, spacing)
      ['fontSize', 'lineSpacing', 'letterSpacing'].forEach(setting => {
        const options = document.querySelectorAll(`.scaling-option[onclick*="updateSetting('${setting}'"]`);
        options.forEach(option => {
          const value = option.getAttribute('onclick').match(/'([^']+)'$/)[1];
          if (settings[setting] === value) {
            option.classList.add('active');
          } else {
            option.classList.remove('active');
          }
        });
      });
    }
    
    // Save settings to localStorage
    function saveSettings() {
      const data = {
        settings: settings,
        activeProfile: activeProfile
      };
      localStorage.setItem('accessibilitySettings', JSON.stringify(data));
    }
    
    // Apply settings to parent window
    function applySettingsToParent() {
      if (window.parent && window !== window.parent) {
        window.parent.postMessage({ 
          type: 'APPLY_SETTINGS',
          settings: settings
        }, '*');
      }
    }
    
    // Handle close button click
    function closePanel() {
      if (window.parent && window !== window.parent) {
        window.parent.postMessage({ type: 'CLOSE_PANEL' }, '*');
      }
    }
    
    // Initialize on load
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>